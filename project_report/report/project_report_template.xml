<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<template id="financier_report_document">
                <div class="page">
		                 <h3 style="text-align:center;">Analyse financière</h3>
		                <h3  style="text-align:center;"><span t-field="doc.name"/> -[ <span t-field="doc.partner_id.name"/>]</h3>
	                <h4>Analyse détaillée</h4>
	                <table class="table table-bordered" style="table-layout: fixed">
		                <thead>
			                <tr>
				                <th  class="text-center" style="width=50%;">Coûts</th>
				                <th  class="text-center"  style="width=50%;">Ventes</th>
			                </tr>
		                </thead>
		                <tbody>
			                <tr>
				                <td  >Factures Fournisseurs</td>
				                <td  >Factures Client</td>
			                </tr>
			                <tr>
				                <t t-set="vendor_invoice" t-value="facture_fournisseur.get(doc.id).get('detail')"/>
				                <t t-set="customer_invoice" t-value="facture_client.get(doc.id).get('detail')"/>
				                <t t-set="expences" t-value="expense_dict.get(doc.id).get('detail')"/>
				                <t t-set="divers" t-value="divers_dict.get(doc.id).get('detail')"/>


				                <td>
					                <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr  t-foreach="vendor_invoice" t-as="inv">
							                <td style="border:  none !important;padding:0; margin:0;">
								                <t t-esc="inv.get('text')"/>
							                </td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="inv.get('amount')" t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>


				                </td>
				                <td>
					                <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr  t-foreach="customer_invoice" t-as="inv">
							                <td style="border:  none !important;padding:0; margin:0;">
								                <t t-esc="inv.get('text')"/>
							                </td>
							                <td style="border: none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="inv.get('amount')" t-options='{"widget": "float", "precision": 2}'/>
							                </td>
						                </tr>

					                </table>


				                </td>

			                </tr>
			                 <tr>
				                 <td>
					                   <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr>
							                <td style="border:  none !important;padding:0; margin:0;text-decoration:underline;">Factures fournisseur</td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="facture_fournisseur.get(doc.id).get('total')"
								                   t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>

				                 </td>
				               <td>
					                <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr>
							                <td style="border:  none !important;padding:0; margin:0;text-decoration:underline;">Factures client</td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="facture_client.get(doc.id).get('total')"
								                   t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>
				               </td>


			                 </tr>
			                <tr>
				                <td>
					                 <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr>
							                <td style="border:  none !important;padding:0; margin:0;text-decoration:underline;">Total main d'oeuvre -
								                <t t-esc="timesheet_dict.get(doc.id).get('total_h',0)"
								                   t-options='{"widget": "float", "precision": 2}'/>heures</td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="timesheet_dict.get(doc.id).get('total_amount', 0)"
								                   t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>

				                </td>
				                <td></td>
			                </tr>
			                <tr>
				                <td>
					                 <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr t-foreach="expences" t-as="exp">
							                <td style="border:  none !important;padding:0; margin:0;">
								                <t t-esc="exp"/></td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="expences.get(exp)" t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>

				                </td>
				                <td></td>
			                </tr>
			                <tr>
				                <td>
					                 <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr>
							                <td style="border:  none !important;padding:0; margin:0;text-decoration:underline;">Frais chantier</td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="expense_dict.get(doc.id).get('total')" t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>
				                </td>
				                <td></td>
			                </tr>
			                 <tr>
				                <td>
					                 <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr t-foreach="divers" t-as="exp">
							                <td style="border:  none !important;padding:0; margin:0;">
								                <t t-esc="exp"/></td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="divers.get(exp)" t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>

				                </td>
				                <td></td>
			                </tr>
			                <tr>
				                <td>
					                 <table class="table" style="border:none !important;font-size:0.8rem;">
						                <tr>
							                <td style="border:  none !important;padding:0; margin:0;text-decoration:underline;">Frais divers</td>
							                <td style="border:  none !important;padding:0; margin:0;" class="text-right">
								                <t t-esc="divers_dict.get(doc.id).get('total')"
								                   t-options='{"widget": "float", "precision": 2}'/></td>
						                </tr>

					                </table>
				                </td>
				                <td></td>
			                </tr>

			                <tr>
				                <td class="text-right"><t t-esc="total_cost.get(doc.id)" t-options='{"widget": "float", "precision": 2}'/></td>
				                <td class="text-right"><t t-esc="total_sale.get(doc.id)"
				                                          t-options='{"widget": "float", "precision": 2}'/></td>
			                </tr>

		                </tbody>
	                </table>
	                <table class="table table-bordered">
		                <tr>
			                <td><strong>Prix de revient margé</strong></td>
			                <td class="text-right"><t t-esc="prix_revient_marge.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
			                <td><strong>Montant du marché de base</strong></td>
			                <td class="text-right"><t t-esc="revenu_prevu_amount.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
		                </tr>
		                <tr>
			                <td><strong>Marge (Vente - prix de revient)</strong></td>
			                <td class="text-right"><t t-esc="total_sale.get(doc.id) - prix_revient_marge.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
			                <td><strong>Montant du marché actualisé</strong></td>
			                <td class="text-right"><t t-esc="doc.montant_marche_actualise" t-options='{"widget": "float", "precision": 2}'/></td>
		                </tr>
		                <tr>
			                <td><strong>Marge réelle (Ventes - coûts)</strong></td>
			                <td class="text-right"><t t-esc="total_sale.get(doc.id) - total_cost.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
			                <td><strong>% de facturation</strong></td>
			                <td class="text-right"><t t-esc="percent_invoice.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
		                </tr>
		                <tr>
			                <td><strong>Coefficient de vente</strong></td>
			                <td class="text-right"><t t-esc="coef_vente.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
			                <td><strong>Reste à facturer</strong></td>
			                <td class="text-right"><t t-esc="revenu_prevu_amount.get(doc.id) - total_sale.get(doc.id)"
			                       t-options='{"widget": "float", "precision": 2}'/></td>
		                </tr>

	                </table>

                </div>
		</template>
		 <template id="financier_report">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.internal_layout">
                        <t t-call="project_report.financier_report_document" t-lang="doc.partner_id.lang"/>
                    </t>
                </t>
            </t>
        </template>
	</data>
</odoo>